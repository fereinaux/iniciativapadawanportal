@using Utils.Extensions;
@using Microsoft.AspNet.Identity
@using Utils.Constants;

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>@ViewBag.Title</h2>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="/Home/Index">Home</a>
            </li>

            <li class="breadcrumb-item active">
                <strong>@ViewBag.Title</strong>
            </li>
        </ol>
    </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight">
    @if (User.IsInRole(Usuario.Admin) || User.IsInRole(Usuario.Master))
    {
        <div class="ibox">
            <div class="ibox-title" style="display: flex;justify-content: space-between;">
                <h4>@ViewBag.Title</h4>

                <div class="ibox-tools pull-right w-300">
                    <div class="row">
                        <div class="col-sm-8">
                            <select class="form-control" id="reuniao-eventoid-consulta" onchange="CarregarTabelaReuniao()">
                                @foreach (var evento in ViewBag.Eventos)
                                {
                                    <option value="@evento.Id">@evento.TipoEvento @evento.Titulo</option>
                                }
                            </select>
                        </div>
                        <div class="col-sm-4">
                            <button class="btn btn-default" id="btn_Adicionar" onclick="EditReuniao(0)">Adicionar</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="ibox-content">
                <table id="table-reunioes" class="table table-striped table-bordered table-hover" cellspacing="0" style="width: 100%">
                    <thead>
                        <tr>
                            <th>Data da Aula</th>
                            <th>Presente</th>
                            <th>Link</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    }
    else
    {
        <div class="ibox">
            <div class="ibox-title" style="display: flex;justify-content: space-between;">
                <h4>@ViewBag.Title</h4>
            </div>
            <div class="ibox-content">
                <table id="table-reunioes" class="table table-striped table-bordered table-hover" cellspacing="0" style="width: 100%">
                    <thead>
                        <tr>
                            <th>Data da Aula</th>
                            <th>Link</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    }
</div>

<div class="modal inmodal" id="modal-anexos" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated bounceInRight">
            <div class="modal-body">
                <div class="moldura-modal p-h-xs">

                    <div class="row p-md">
                        @if (User.IsInRole(Usuario.Admin) || User.IsInRole(Usuario.Master))
                        {
                            <form enctype="multipart/form-data" id="frm-upload-arquivo-modal" method="post" novalidate="novalidate">
                                <input type="hidden" name="ReuniaoIdModal" id="ReuniaoIdModal" />
                                <label for="arquivo-modal" style="width: 100%;" class="inputFile">
                                    <span class="btn btn-default inputFile" style="width: 100%;" aria-hidden="true">Adicionar</span>
                                    <input style="display: none;" class="custom-file-input inputFile" id="arquivo-modal" name="arquivo-modal" type="file" value="">
                                </label>
                            </form>
                        }
                        <table id="table-anexos" class="table table-striped table-bordered table-hover" cellspacing="0" style="width: 100%">
                            <thead>
                                <tr>
                                    <th>Arquivo</th>
                                    <th>Extensão</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-white pull-right m-l-sm" data-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal inmodal" id="modal-reunioes" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated bounceInRight">
            <div class="modal-body">
                <div class="moldura-modal p-h-xs" id="form-reuniao">
                    <div class="row p-h-xs">
                        <input type="hidden" id="reuniao-id" />
                        <div class="col-sm-6 p-w-md text-center">
                            <h5>Data da Aula</h5>

                            <input type="text" class="form-control full-date required" id="reuniao-data" data-field="Data da Aula" />
                        </div>
                        <div class="col-sm-6 p-w-md text-center">
                            <h5>Link</h5>

                            <input type="text" class="form-control" id="reuniao-link" data-field="Link" />
                        </div>

                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-white pull-right m-l-sm" data-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-white pull-right" onclick="PostReuniao()">Salvar</button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {

}

@section Scripts {

    <script src="~/Scripts/app/Reuniao/reuniao.js"></script>

    <script>
        var columnsAnexos = '@(User.IsInRole(Usuario.Admin) || User.IsInRole(Usuario.Master))' == 'True' ? [
            { data: "Nome", name: "Nome", autoWidth: true },
            { data: "Extensao", name: "Extensao", autoWidth: true },
            {
                data: "Id", name: "Id", orderable: false, width: "15%",
                "render": function (data, type, row) {
                    return `${GetButton('GetArquivo', data, 'blue', 'fa-download', 'Download')}
                            ${GetButton('DeleteArquivo', data, 'red', 'fa-trash', 'Excluir')}`;
                }
            }
        ] : [
            { data: "Nome", name: "Nome", autoWidth: true },
            { data: "Extensao", name: "Extensao", autoWidth: true },
            {
                data: "Id", name: "Id", orderable: false, width: "15%",
                "render": function (data, type, row) {
                    return `${GetButton('GetArquivo', data, 'blue', 'fa-download', 'Download')}`;
                }
            }
        ]
        var columns = '@(User.IsInRole(Usuario.Admin) || User.IsInRole(Usuario.Master))' == 'True' ? [
            {
                data: "DataReuniao", name: "DataReuniao", autoWidth: true,
                "render": function (data, type, row) {
                    return `${moment(data).format('DD/MM/YYYY')} `;
                }
            },
        { data: "Presenca", name: "Presenca", autoWidth: true },
        {
            data: "Link", name: "Link", orderable: false, autoWidth: true,
                "render": function (data, type, row) {
                    return data ? `<a href="${data}" target="_blank">${data}</a>` : '';
                }
        },
        {
            data: "Id", name: "Id", orderable: false, width: "10%",
                "render": function (data, type, row) {
                    return `
${GetAnexosButton('Anexos', data, row.QtdAnexos)}
${GetButton('EditReuniao', data, 'blue', 'fa-edit', 'Editar')}
                               ${GetButton('DeleteReuniao', data, 'red', 'fa-trash', 'Excluir')}`;
                }
        }
        ] : [
            {
                data: "DataReuniao", name: "DataReuniao", autoWidth: true,
                "render": function (data, type, row) {
                    return `${moment(data).format('DD/MM/YYYY')} `;
                }
            },
            {
                data: "Link", name: "Link", orderable: false, autoWidth: true,
                "render": function (data, type, row) {
                    return data ? `<a href="${data}" target="_blank">${data}</a>` : '';
                }
            },
            {
                data: "Id", name: "Id", orderable: false, width: "10%",
                "render": function (data, type, row) {
                    return `
${GetAnexosButton('Anexos', data, row.QtdAnexos)}`;
                }
            }
        ]

        console.log(columns)
    </script>
}
